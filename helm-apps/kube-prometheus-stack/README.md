# install-kube-prometheus-stack

<!-- TOC -->

- [install-kube-prometheus-stack](#install-kube-prometheus-stack)
- [Requirements](#requirements)
- [Accessing Prometheus](#accessing-prometheus)
- [Troubleshooting of Prometheus installation](#troubleshooting-of-prometheus-installation)
- [Accessing AlertManager](#accessing-alertmanager)
- [Accessing Grafana](#accessing-grafana)
- [References:](#references)

<!-- TOC -->

# Requirements

- Install all packages and binaries following the instructions on the [REQUIREMENTS.md](../../REQUIREMENTS.md) file.
- Create the cluster following the instructions on the [README.md](../../README.md#create-the-cluster-and-deploy-applications) file.

# Accessing Prometheus

Use command follow to access Prometheus:

```bash
kubectl port-forward svc/monitor-mycompany-prometheus -n monitoring 9090:9090
```

Access your web navigator in URL http://localhost:9090

# Troubleshooting of Prometheus installation

List the resources.

```bash
kubectl get all -n monitoring
```

See the status of the pod with the following command:

```bash
kubectl --namespace monitoring get pods -l "release=monitor"
```

See the Prometheus log with the following command:

```bash
kubectl logs -f prometheus-monitor-mycompany-prometheus-0 -c prometheus -n monitoring
```

Commands needed to directly perform or debug any promised content for the ``prometheus-monitor-mycompany-prometheus-0`` pod in namespace ``monitoring`` each Kubernetes clusters.

```bash
kubectl exec -it prometheus-monitor-mycompany-prometheus-0 -n monitoring -- sh
```

See configuration file of Prometheus inside Pod generated by Prometheus-Operator:

```bash
cat /etc/prometheus/config_out/prometheus.env.yaml

ls /etc/prometheus/rules/*
```

See resources of pods in use:

```bash
kubectl describe pod/prometheus-monitor-mycompany-prometheus-0 -n monitoring

kubectl top pods -n monitoring

kubectl top nodes -n monitoring
```

More informations about Throubleshooting in Prometheus-Operator are available [in this page](https://github.com/coreos/prometheus-operator/blob/master/Documentation/troubleshooting.md)

# Accessing AlertManager

If deploy alertmanager is defined with value ``true`` in file ``install_prometheus-operator_k8s/helm_vars/values.yaml``, then use command follow to access AlertManager:

```bash
kubectl port-forward svc/alertmanager-operated -n monitoring 9093:9093
```

Access your web navigator in URL http://localhost:9093

# Accessing Grafana

If deploy grafana is defined with value ``true`` in file ``install_prometheus-operator_k8s/helm_vars/values.yaml``, then use command follow to access Grafana:

```bash
kubectl port-forward svc/monitor-grafana 3000:80 -n monitoring
```

Access your web navigator in URL http://localhost:3000

- **login**: admin
- **password**: prom-operator

To edit password default of Grafana, edit secrets of Grafana of Prometheus Operator:

```bash
kubectl edit secrets monitor-grafana -n monitoring
```

Reference: https://dev.to/rayandasoriya/comment/dckk


# References:

- 
